---
title: 家庭网络拓扑2
tags: default
---

和[当初的规划](https://pzweuj.github.io/posts/network-topology)时隔三年，更新一下现在实际的网络拓扑。

## 现实情况

当初希望每个房间都有一个RJ45面板，但是实际情况是精装交付的房子，并不会想再花钱去再埋管穿线（增加电位除外），因此还是使用现有的面板位置。我的户型中只有弱电箱（三个RJ45）、客厅（两个RJ45）、主卧（一个RJ45）布局了面板，次卧和书房都没有😓。

因此，实际方案确立的是几乎所有用网设备都是无线接入的模式。为了增强网络体验，我在上述的三个位置都布局了路由器进行有线mesh（哈哈小户型用了三个路由，也是服了自己）。

这里其实主卧的点位与其他点位之间隔了两堵墙（包含承重墙），还是有必要增加的。而客厅点位和入户弱电箱点位，基本无遮挡。因此我把客厅的路由尽量靠阳台放了。

我原意是想把主路由（BE6500Pro）放在弱电箱里的，但是在我实际测试中，将它放在客厅里，对我在书房中的台式电脑网络信号和网速有明显提升。因此现在是弱电箱的光猫连接到客厅的主路由，然后主路由再从客厅第二个接口里回到弱电箱，连接到子路由1号（红米AX3000T），从子路由1号连接到主卧的子路由2号（红米AX3000T），这样接节省了交换机。


## 其他设备连接情况

BE6500Pro只有4个RJ45接口，接了光猫和回程后，剩余的2个接口我都接到了我的NAS（双网口）中。

在NAS中，其中一个网口（LAN1）固定作为各种服务的IP。然后另外一个网口（LAN2）以MacVTap的方式与iStoreOS虚拟机绑定，将虚拟机作为旁路由。我原本认为，这样是可以直接以LAN2的IP访问虚拟机的，然后LAN2可以与我NAS的服务隔离。但我实际发现，仍然能用LAN2的IP访问NAS的服务。由于我的NAS系统不能禁用网卡，经Gemini指点，给LAN2手动分配一个“死”IP（完全独立的子网），这样在主网络中，这个IP是不可路由的，就不能使用这个IP访问NAS的服务（可以进一步设定防火墙规则，拒绝所有LAN2的流量）。

然后iStoreOS虚拟机中静态配置一个主网络中的IP。通过这个方案，**可能**可以让虚拟机独占LAN2的带宽、网络隔离、简化故障排除（俺不懂，Gemini说的😂）。

最后，iStoreOS中安装了ADguard Home、MosDNS、欧朋卡列什三件套。需要魔法用网的设备，只要设定网关和DNS地址，就能实现无障碍访问。

----------------

旁路由方案不影响家庭中的其他设备，出现问题将魔法设备的手动配置改为自动配置即可。


## 拓扑图

下面是现在的网络拓扑图。

![top](https://raw.githubusercontent.com/pzweuj/pzweuj.github.io/refs/heads/master/content/data/images/network_topology_2.png)

