# æ¯”å¯¹åŠå»é‡

æ¯”å¯¹æ˜¯ç”Ÿç‰©ä¿¡æ¯åˆ†ææœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œå°±æ˜¯æŠŠè‡ªå·±çš„æ•°æ®æ‹¿å»è·Ÿå‚è€ƒæ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œå¾—åˆ°å·®å¼‚çš„ç»“æœã€‚è€Œå½“æ‰€è¦åˆ†æçš„æ•°æ®æ˜¯å˜å¼‚æ—¶ï¼Œå·®å¼‚çš„ç»“æœå°±æ˜¯çªå˜çš„ç¢±åŸºï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯çªå˜çš„åŸºå› ã€‚

## å»ºç«‹ç´¢å¼•

é¦–å…ˆéœ€è¦ä¸‹è½½ä¸€ä¸ªå‚è€ƒåŸºå› ç»„ï¼Œæ­£å¦‚å‰é¢æ‰€è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨hg38(GRCh38)ã€‚hg38åŸºå› ç»„ä¹Ÿæœ‰å¤šä¸ªæ¥æºï¼Œæ¯”å¦‚[UCSC](https://hgdownload.soe.ucsc.edu/goldenpath/hg38/bigZips/)ã€[GIAB](https://www.nist.gov/programs-projects/genome-bottle)ã€[GATK](https://gatk.broadinstitute.org/hc/en-us/articles/360035890811-Resource-bundle)ã€[NCBI](https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_000001405.40/)ã€[NCI](https://gdc.cancer.gov/about-data/gdc-data-processing/gdc-reference-files)ç­‰ç­‰ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨NCIçš„hg38ï¼Œä¸»è¦æ˜¯å› ä¸ºä¹‹å‰åšè‚¿ç˜¤çº¿çš„å†…å®¹æ˜¯å·²ç»ä¸‹äº†ğŸ˜€ã€‚

å°†fasta(fna)ä¸‹è½½ä¸‹æ¥åï¼Œä¸ºäº†åç»­ä½¿ç”¨[bwa](https://bio-bwa.sourceforge.net/)è¿›è¡Œæ¯”å¯¹ï¼Œéœ€è¦å…ˆå»ºç«‹ç´¢å¼•ã€‚å»ºè®®åŒæ—¶ä½¿ç”¨[samtools](http://www.htslib.org/)å»ºç«‹ç´¢å¼•ã€‚

```bash
bwa index GRCh38.d1.vd1.fa
samtools faidx GRCh38.d1.vd1.fa
```



## æ¯”å¯¹

ä½¿ç”¨bwa memè¿›è¡Œæ¯”å¯¹ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ç®¡é“åŒæ—¶åˆ©ç”¨samtoolsè¿›è¡Œæ’åºï¼Œäº§ç”ŸäºŒè¿›åˆ¶çš„bamæ–‡ä»¶ã€‚
```bash
bwa mem -t 16 GRCh38.d1.vd1.fa \
    cleandata/SRR14724513_1.fq.gz \
    cleandata/SRR14724513_2.fq.gz \
    -R "@RG\tSM:SRR14724513\tID:mapping\tPL:illumina\tPU:WES" \
    | samtools view -bSh - | samtools sort -@ 16 - -o bam/SRR14724513.sort.bam
samtools index bam/SRR14724513.sort.bam
```

è¿™æ ·ï¼Œå°±è·å¾—äº†bamæ–‡ä»¶ã€‚æ¯”å¯¹æ—¶åŠ¡å¿…åŠ å…¥ -R å‚æ•°ï¼Œä¸ç„¶éƒ¨åˆ†è¯†åˆ«SM tagçš„ç¨‹åºå¯èƒ½ä¼šæŠ¥é”™ã€‚å½“ç„¶ï¼Œå¦‚æœå¿˜è®°åŠ è¿™ä¸ªå‚æ•°ï¼Œåˆæˆ–è€…å‚æ•°éœ€è¦è°ƒæ•´ï¼Œå¯ä»¥ä½¿ç”¨gatkä¸­çš„AddOrReplaceReadsGroupå·¥å…·ã€‚



## æ ‡è®°é‡å¤

éœ€è¦å¯¹é‡å¤readsè¿›è¡Œæ ‡è®°ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šç»™é‡å¤readsæ ‡è®°ä¸Šä¸€ä¸ª1024çš„flagå€¼ã€‚å°½ç®¡[sambamba](https://github.com/biod/sambamba)åœ¨æ­¤è¿‡ç¨‹ä¸­çš„æ•ˆç‡æœ€é«˜ï¼Œä½†ç›®å‰ä»å»ºè®®ä½¿ç”¨picard/gatkã€‚è¿™é‡Œä½¿ç”¨[gatk](https://github.com/broadinstitute/gatk)ã€‚

```bash
gatk MarkDuplicates \
    -I bam/SRR14724513.sort.bam \
    -O bam/SRR14724513.markdup.bam \
    -M bam/SRR14724513.metrics.txt \
    --CREATE_INDEX true
mv bam/SRR14724513.markdup.bai bam/SRR14724513.markdup.bam.bai
rm bam/SRR14724513.sort.bam*
```



## ç»“æœè´¨æ§

åœ¨æ¯”å¯¹åï¼Œä¹‹å‰ä¸‹è½½çš„bedæ–‡ä»¶å³å¯æ´¾ä¸Šç”¨åœºï¼Œå¯ä»¥ç”¨æ¥ç»Ÿè®¡é¶å‘åŒºåŸŸçš„è¦†ç›–æƒ…å†µã€è¦†ç›–æ·±åº¦ã€åœ¨é¶ç‡ã€é‡å¤ç‡ç­‰ä¿¡æ¯ã€‚

### æ¯”å¯¹ä¿¡æ¯ç»Ÿè®¡
ä½¿ç”¨[bamdst](https://github.com/shiquan/bamdst)ç»Ÿè®¡ã€‚bamdstè¿™é‡Œå¯ä»¥åŠ å…¥--cutoffdepthå‚æ•°æ¥æ·»åŠ è‡ªå·±å…³æ³¨çš„æ·±åº¦è¦†ç›–åº¦ã€‚

```bash
bamdst -p bed/S31285117_Covered.bed bam/SRR14724513.markdup.bam -o qc
```



### æ–‡åº“ä¿¡æ¯ä¼°è®¡

ä½¿ç”¨gatkæ¥ç»Ÿè®¡å„ç§è´¨é‡ä¿¡æ¯ã€‚

```bash
gatk CollectInsertSizeMetrics \
    -I bam/SRR14724513.markdup.bam \
    -O qc/metrics/SRR14724513.insertsize.txt \
    -H qc/metrics/SRR14724513.histogram.pdf

gatk CollectAlignmentSummaryMetrics \
    -I bam/SRR14724513.markdup.bam \
    -R GRCh38.d1.vd1.fa \
    -O qc/metrics/SRR14724513.metrics.txt

gatk BedToIntervalList \
    -I bed/S31285117_Covered.bed \
    -O S31285117.interval_list \
    -SD GRCh38.d1.vd1.fa

gatk CollectHsMetrics \
    -BI S31285117.interval_list \
    -TI S31285117.interval_list \
    -I bam/SRR14724513.markdup.bam \
    -O qc/metrics/SRR14724513.hs.txt
```



### æ€§åˆ«è¯„ä¼°

éœ€è¦è®¡ç®—æ•°æ®çš„æ€§åˆ«ï¼Œç„¶åä¸´åºŠä¿¡æ¯æ€§åˆ«è¿›è¡Œæ¯”è¾ƒï¼Œä½œä¸ºæ•°æ®çš„ä¸€ä¸ªåˆæ­¥è´¨æ§ã€‚

æœ‰ä¸‰ç§å¯è¡Œçš„æ–¹å¼ï¼š

1ï¼Œæ¯”å¯¹åˆ°Yå’Œæ¯”å¯¹åˆ°Xçš„æ ¡æ­£readsæ¯”ä¾‹ï¼Œå¯¹è‹¥å¹²ç”·æ€§ã€å¥³æ€§çš„æ ·æœ¬è¿›è¡Œç»Ÿè®¡ï¼Œè·å¾—ä¸€ä¸ªèƒ½ç¡®åˆ‡åŒºåˆ†çš„é˜ˆå€¼ï¼Œå¯ä»¥ä½¿ç”¨bamä½œä¸ºè¾“å…¥æ–‡ä»¶ï¼›åœ¨å‘ç”ŸXæŸ“è‰²ä½“å¼‚å¸¸æ—¶å¯èƒ½ä¸å‡†ï¼›

2ï¼Œ[ç»Ÿè®¡Xçš„æ‚åˆæ¯”ä¾‹](https://pzweuj.github.io/posts/gender_predict)ï¼ŒåŸç†æ˜¯ç”·æ€§çš„XæŸ“è‰²ä½“çªå˜ä¸€èˆ¬éƒ½æ˜¯çº¯åˆï¼Œå› æ­¤å¯¹è‹¥å¹²ç”·æ€§ã€å¥³æ€§çš„æ ·æœ¬è¿›è¡Œç»Ÿè®¡Xçš„æ‚åˆæ¯”ä¾‹ï¼Œå°±å¯è·å¾—ä¸€ä¸ªç¡®åˆ‡çš„åŒºåˆ†é˜ˆå€¼ï¼Œå¯ä»¥ä½¿ç”¨vcfä½œä¸ºè¾“å…¥æ–‡ä»¶ï¼›åœ¨å‘ç”ŸXæŸ“è‰²ä½“å¼‚å¸¸æ—¶å¯èƒ½ä¸å‡†ï¼›

3ï¼Œ[ç»Ÿè®¡SRYåŸºå› ](https://pzweuj.github.io/posts/gender_predict)çš„è¦†ç›–readsæ•°ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨bamä½œä¸ºè¾“å…¥æ–‡ä»¶ã€‚

```bash
samtools view -F 2052 bam/SRR14724513.markdup.bam Y:2786855-2787682 | wc -l
```

